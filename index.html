<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hello PWA</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="main.css">
  <link rel="manifest" href="./mainifest.json">
  <link rel="icon" href="icon.png" type="image/png" />
  <!-- 指定桌面icon -->
  <link rel="apple-touch-icon" href="images/timg.png">
  <!-- 指定应用名称 -->
  <meta name="apple-mobile-web-app-title" content="PWA DEMO">
  <!-- 是否隐藏Safari地址等 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- 修改IOS状态栏颜色 -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <script type="text/javascript" src="js/vue.js"></script>
  <script src="./js/ui.js"></script>
  <link rel="stylesheet" href="./css/ui.css">
</head>
<body>
  <div id="app">
    <h3>{{title}}</h3>
    <img src="test.jpg" alt="" class="test">
    <ul>
      <li v-for="(item,index) in list" :key="index">{{item.title}}</li>
    </ul>
  </div>
</body>
<script src="./index.js"></script>
<script>
  // 检测浏览器是否支持SW
  if(navigator.serviceWorker != null){
    navigator.serviceWorker.register('sw.js')
    .then(function(registartion){
    //注册成功
      console.log('注册成功:',registartion.scope)
    }).catch(function (err){
      console.log('fail')
    });
  }

  window.addEventListener('load', function() {
    // 当页面的控制权发生变化的时候走这里
    navigator.serviceWorker.oncontrollerchange = function() {
      ui.showTips('页面已更新');
    }
    if (!window.navigator.onLine) {
      ui.showTips('你断网了，可能数据没更新', 'warn');
    }
    window.addEventListener('online', function() {
      ui.showTips('重新连接网络，刷新加载最新数据');
    })
  });
</script>
<script>
  Vue.config.productionTip = false;
  new Vue({
    el: '#app',
    data: {
      title: 'Hello',
      list: [],
    },
    mounted() {
      getNews().then((res) => {
        const { title, list } = res.data;
        this.title = title;
        this.list = list;
      })
    }
  })
  
</script>
</html>
